@if (this.store.isLoaded()) {
  <div
    class="z-30 overscroll-none scrollbar-hide font-tektur flex min-h-[100dvh] flex-col gap-4 pb-24 pt-[env(safe-area-inset-top,0px)] sm:gap-6 sm:pb-12 xl:gap-0 xl:pb-0">
    <app-game-header (openPrestige)="toggleModal('prestige',true)" (openProfile)="toggleModal('profile', true)"
                     [session]="this.store.session()"></app-game-header>
    <div
      class="!z-max flex w-full flex-col gap-4 px-4 sm:px-6 xl:flex-1 xl:flex-row xl:items-end xl:justify-between xl:gap-0 xl:px-0">
      <div class="fixed bottom-14 w-auto">
        <button
          (click)="toggleMobileUpgrades(true)"
          class="z-max mt-4 flex w-full items-center justify-center gap-2 rounded-3xl border-2 border-black bg-secondary px-4 py-3 text-lg font-bold text-black shadow-[0_6px_0_rgba(0,0,0,0.15)] transition active:scale-95 xl:hidden"
          type="button"
        >
          <img alt="" class="h-6 w-6" src="/icons/upgrades.svg"/>
          Улучшения
        </button>
        <app-game-buttons (cook)="handleCook()" (sell)="handleSell()"
                          [level]="this.store.session()?.level?.rank ?? 0"></app-game-buttons>
      </div>
      <div class="hidden w-full xl:block xl:w-auto">
        <app-menu></app-menu>
      </div>
    </div>
  </div>

  <div [ngSwitch]="locationConfig.component">
    <app-track *ngSwitchCase="'track'" [decorCount]="4"></app-track>
    <app-cafe *ngSwitchCase="'cafe'"></app-cafe>
    <app-restaurant *ngSwitchCase="'restaurant'"></app-restaurant>
    <app-gastro-restaurant *ngSwitchCase="'gastro'"></app-gastro-restaurant>
    <app-final *ngSwitchCase="'final'"></app-final>
  </div>

  <img
    *ngIf="locationConfig.imgSrc"
    [ngClass]="locationConfig.imgClass"
    [src]="locationConfig.imgSrc"
    class="fixed bottom-[5dvh] left-[10dvw] z-max hidden xl:block"
  />

  <app-modal (close)="toggleModal('profile',false)" [background]="'bg-secondary'" [border_color]="'brand'"
             [border_size]="16"
             [closeOnBackdrop]="true"
             [show]="profileWindowToggle">
    <app-profile (logoutEvent)="toggleModal('logout',$event)"></app-profile>
  </app-modal>

  <app-modal (close)="toggleModal('logout',false)" [background]="'bg-secondary'"
             [border_color]="'brand'"
             [border_size]="16"
             [closeOnBackdrop]="true"
             [show]="logoutWindowToggle">
    <div class="flex flex-col items-center font-tektur py-[3.5dvh] px-[8.5dvw] drop-shadow-md">
      <h2 class="text-white text-center md:text-4xl drop-shadow-[0_1.5px_1.5px_rgba(0,0,0,1)]">Вы уверены, <br>что
        хотите выйти?</h2>
      <section class="flex flex-col gap-4 sm:flex-row sm:gap-5 w-full">
        <button (click)="logout()"
                class="bg-green-600 border-2 border-black mt-[2.5dvh] rounded-2xl px-6 py-3 font-bold text-2xl text-white w-full sm:w-auto">
          Да
        </button>
        <button (click)="toggleModal('logout',false)"
                class="bg-red border-2 border-black mt-[2.5dvh] rounded-2xl px-6 py-3 font-bold text-2xl text-white w-full sm:w-auto">
          Нет
        </button>
      </section>
    </div>
  </app-modal>

  <app-prestige-window (closeEvent)="toggleModal('prestige',$event)"
                       [enabled]="prestigeWindowToggle"></app-prestige-window>

  <div class="fixed z-max sound-control">
    <button
      #soundButton
      (click)="toggleVolumeSlider()"
      class="sound-btn border-2 border-black rounded-full bg-secondary shadow-[0_6px_0_rgba(0,0,0,0.15)] active:scale-95 transition"
      type="button"
    >
      <img
        [src]="sound.currentVolume > 0 ? '/icons/sound-on.svg' : '/icons/sound-off.svg'"
        alt="Звук"
        class="w-7 h-7"
      />
    </button>

    <div
      *ngIf="showVolumeSlider"
      [ngClass]="{ 'animate-fade-in': !isClosingVolumeSlider, 'animate-fade-out': isClosingVolumeSlider }"
      class="volume-slider-popover"
    >
      <input
        (input)="onVolumeChange($event); resetVolumeCloseTimer()"
        (pointerdown)="resetVolumeCloseTimer()"
        (pointerup)="resetVolumeCloseTimer()"
        [value]="sound.currentVolume"
        class="volume-slider"
        max="100"
        min="0"
        type="range"
      />
    </div>
  </div>


  <div
    *ngIf="showMobileUpgrades"
    class="fixed inset-0 z-max flex flex-col bg-black/60 backdrop-blur-sm xl:hidden"
  >
    <button
      (click)="toggleMobileUpgrades(false)"
      aria-label="Закрыть меню улучшений"
      class="flex-1"
      type="button"
    ></button>
    <div class="mt-auto w-full px-4 pb-6">
      <app-menu (close)="toggleMobileUpgrades(false)" [showCloseButton]="true"></app-menu>
    </div>
  </div>

  <div
    *ngIf="showLevelUpNotification"
    class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-6 py-3 rounded-2xl text-lg shadow-lg transition-opacity duration-500 opacity-100 z-50">
    Уровень повышен до {{ this.store.session()?.level?.rank ?? 0 }}!
  </div>

} @else {
  <app-loading></app-loading>
}
